services:
  # ===== Backend (FastAPI + Docker) =====
  - type: web
    name: auctionhub-backend
    runtime: docker
    plan: free
    branch: main

    # Docker build paths (relative to repo root)
    dockerfilePath: backend/Dockerfile
    dockerContext: backend

    # Health check endpoint
    healthCheckPath: /

    envVars:
      # ⚠️ ตั้งค่าใน Render Dashboard แทน (ไม่ควร commit secrets)
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      # Optional: frontend URL for CORS
      - key: FRONTEND_URL
        fromService:
          name: auctionhub-frontend
          type: web
          property: url

  # ===== Frontend (React + Vite + Docker) =====
  - type: web
    name: auctionhub-frontend
    runtime: docker
    plan: free
    branch: main

    dockerfilePath: frontend/Dockerfile
    dockerContext: frontend

    envVars:
      # Backend API URL (auto-link from backend service)
      - key: VITE_API_BASE_URL
        fromService:
          name: auctionhub-backend
          type: web
          property: url
      # Supabase (frontend ใช้ anon key เท่านั้น)
      - key: VITE_SUPABASE_URL
        sync: false
      - key: VITE_SUPABASE_ANON_KEY
        sync: false